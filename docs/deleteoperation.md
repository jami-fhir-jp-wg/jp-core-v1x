## データのライフサイクル

## 履歴有無
FHIRデータの扱いとして、履歴データを保存するかどうかを決める必要がある。
電子保存等の理由がある場合には、履歴データを保持する必要がある。
履歴保持の義務がなく、データストレージ容量に制約がある場合には履歴データを保持しないという選択肢もある。
履歴を保持しているFHIRサーバは、_hisotry等の履歴に関する操作についてサポートする必要がある。


## 削除
FHIRリソースの削除には、論理削除と物理削除の2つの方法が存在する。

### 論理削除
論理削除と物理削除のどちらを選択するかは、特定のユースケースと組織のポリシーによって決定される。 
履歴の有無にかかわらず法的または規制上の義務がない限り、論理削除が推奨される。

#### ステータスによる無効化（論理削除）
リソースの中に状態に関する項目があり、この値を変更することで論理的な削除状態にすることも可能である。
削除状態はは状態フラグの更新操作にて操作される。

#### ストレージ側の管理による削除フラグ
論理削除は、リソースをデータベースから完全に削除するのではなく、削除済みとしてマークするものである。ソースの削除を記録する必要があるが、監査や参照のためにデータを残しておくことができる。
復元はキーに対する更新処理によって行われる。

* 利点

データの完全性を維持する<br/>
監査とレポートの目的で削除されたデータを保持する<br/>
誤って削除した場合に必要に応じてデータを簡単に復元できる<br/>

* 欠点

ストレージ容量が増加する可能性がある<br/>
削除済みデータへの不正アクセスを防ぐためのセキュリティ対策が必要になる可能性がある<br/>


### 物理削除

物理削除は、データベースからリソースを完全に削除することである。 リソースが不要になった場合、または法的または規制上の理由でデータを削除する必要がある場合に有効である。

ユースケース例

患者の要求によるデータ削除：<br/>
患者が自分の医療記録の削除を要求した場合、法的義務に従って物理削除する必要がある場合がある。<br/>
セキュリティ侵害後のデータの消去：<br/>
セキュリティ侵害が発生し、特定のリソースが侵害された場合、さらなる損害を防ぐために物理削除が必要になる場合がある。<br/>
テストデータのクリーンアップ：<br/>
開発またはテスト環境で不要になったテストデータをクリーンアップする。

* 利点

ストレージ容量を削減する<br/>
データのプライバシーとセキュリティを強化する<br/>

* 欠点

データが完全に失われ、復元できない<br/>
誤って削除した場合、重大な問題が発生する可能性がある<br/>


### 監査ログ
論理削除、物理削除の両方で監査ログとして、日時、端末、操作者でログを出力する。













